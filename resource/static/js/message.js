window.onload = function () {var User = prompt("快取个名字闪亮登场吧!", "");while (true) {if (User == "") {var User = prompt("快取个名字闪亮登场吧!", "");} else {break;}}var Words = document.getElementById("words");var Who = document.getElementById("who");var TalkWords = document.getElementById("talkwords");var TalkSub = document.getElementById("talksub");var numberInfo = document.getElementById('number');var WsUrl = document.getElementById("ws-url");var url = "ws:" + WsUrl.value + "/ws?username=" + User;/* 建立socket链接*/ws = new WebSocket(url);ws.onopen = function (evt) {/* ws.send("加入群聊!");*/};ws.onmessage = function (evt) {var data = JSON.parse(evt.data);str = '<div class="atalk"><span>' + data.UserName + ' :' + data.Msg + '</span></div>';Words.innerHTML = Words.innerHTML + str;Words.scrollTop = Words.scrollHeight;numberInfo.innerHTML = "当前人数&nbsp;:" + data.Total;showNotification("来自用户" + data.UserName + "的消息:" + data.Msg);/* var audio = new Audio("http:" + WsUrl.value + "/static/audio/9411.wav"); audio.play();*/};ws.onclose = function (msg) {layer.open({content: '已断开', skin: 'msg', time: 2 /*2秒后自动关闭*/});};TalkSub.onclick = function () {sendMessage();};document.onkeydown = function (event) {var e = event || window.event || arguments.callee.caller.arguments[0];if (e && e.keyCode == 13) { /* enter 键*/sendMessage();}};function sendMessage() {/*定义空字符串*/var str = "";var content = TalkWords.value;if (content === "") {/* 消息为空时弹窗*/alert("消息不能为空");return;}TalkWords.value = " ";ws.send(content);str = '<div class="btalk"><span>' + content + '</span></div>';Words.innerHTML = Words.innerHTML + str;Words.scrollTop = Words.scrollHeight;}function showNotification(msg) {window.Notification.permission = "granted";if (window.Notification) {if (window.Notification.permission === "granted") {var notification = new Notification('你有一条新信息', {body: msg,});setTimeout(function () {notification.close();}, 2000);} else {window.Notification.requestPermission();}} else {alert('你的浏览器不支持此消息提示功能，请使用chrome内核的浏览器！');}}}